<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drone Detection System</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.0.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.2.0"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
          <div class="logo">
            <i class="fas fa-drone-alt"></i>
            <h1>Drone Detection</h1>
          </div>
          <div class="system-status">
            <div class="status-indicator connecting" id="statusIndicator"></div>
            <span id="statusText">Initializing...</span>
            <span class="text-mono" id="currentTime"></span>
          </div>
        </header>
      
        <!-- Main Dashboard -->
        <main class="dashboard-grid">
          <!-- Detection Panel -->
          <section class="card detection-panel">
            <div class="card-header">
              <h2><i class="fas fa-microphone"></i> Audio Analysis</h2>
              <div class="controls">
                <button class="btn btn-primary" id="startBtn">
                  <i class="fas fa-microphone"></i> Start
                </button>
                <button class="btn btn-danger" id="stopBtn" disabled>
                  <i class="fas fa-microphone-slash"></i> Stop
                </button>
                <button class="btn btn-secondary" id="calibrateBtn">
                  <i class="fas fa-fan"></i> Calibrate
                </button>
              </div>
            </div>
      
            <div class="card-content">
              <div class="alert-banner" id="droneAlert" hidden>
                <i class="fas fa-exclamation-triangle"></i>
                <span id="alertType">POTENTIAL DRONE DETECTED!</span>
              </div>
      
              <div class="audio-controls">
                <div class="control-group">
                  <label>Mic Gain</label>
                  <div class="control-wrapper">
                    <input type="range" id="gainControl" min="0" max="2" step="0.1" value="1">
                    <span class="text-mono" id="gainValue">1.0</span>
                  </div>
                </div>
                <div class="control-group">
                  <label>Sensitivity</label>
                  <div class="control-wrapper">
                    <input type="range" id="sensitivity" min="0.5" max="2" step="0.1" value="1">
                    <span class="text-mono" id="sensitivityValue">1.0</span>
                  </div>
                </div>
              </div>
      
              <div class="stats-container">
                <div class="stats-grid">
                  <div class="stat-card">
                    <div class="stat-icon">
                      <i class="fas fa-volume-up"></i>
                    </div>
                    <div class="stat-info">
                      <div class="stat-label">Audio Level</div>
                      <div class="stat-value text-mono">- dB</div>
                    </div>
                  </div>
                  
                  <div class="stat-card">
                    <div class="stat-icon">
                      <i class="fas fa-waveform"></i>
                    </div>
                    <div class="stat-info">
                      <div class="stat-label">Frequency</div>
                      <div class="stat-value text-mono">- Hz</div>
                    </div>
                  </div>
                  
                  <div class="stat-card">
                    <div class="stat-icon">
                      <i class="fas fa-percent"></i>
                    </div>
                    <div class="stat-info">
                      <div class="stat-label">Confidence</div>
                      <div class="stat-value text-mono">0%</div>
                    </div>
                  </div>
                  
                  <div class="stat-card">
                    <div class="stat-icon">
                      <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-info">
                      <div class="stat-label">Duration</div>
                      <div class="stat-value text-mono">00:02</div>
                    </div>
                  </div>
                </div>
              </div>
      
              <div class="chart-container">
                <canvas id="frequencyChart"></canvas>
              </div>
            </div>
          </section>
      
          <!-- Detection Log -->
          <section class="card log-panel">
            <div class="card-header">
              <h2><i class="fas fa-list"></i> Detection Log</h2>
              <button class="btn btn-icon" id="clearLogs">
                <i class="fas fa-trash-alt"></i>
              </button>
            </div>
            <div class="card-content">
              <div class="detections-list" id="detectionsList">
                <div class="empty-state">
                  <i class="fas fa-microphone"></i>
                  <p>Waiting for audio input...</p>
                </div>
              </div>
            </div>
          </section>
      
<!-- GNSS Panel -->
<section class="card gnss-panel">
    <div class="card-header">
      <h2><i class="fas fa-satellite-dish"></i> GNSS Status</h2>
      <button class="btn btn-secondary" id="refresh-gnss">
        <i class="fas fa-sync-alt"></i> Refresh
      </button>
    </div>
    
    <div class="card-content">
      <!-- Connection Status -->
      <div class="gnss-status">
        <div class="status-indicator" id="gnss-connection-indicator"></div>
        <span id="gnss-status-text">Disconnected</span>
        <span class="text-mono" id="gnss-last-update">--:--:--</span>
      </div>
      
      <!-- Charts Section -->
      <div class="chart-grid">
        <!-- Satellite Comparison Chart -->
        <div class="chart-card">
          <h3><i class="fas fa-chart-bar"></i> Satellite Comparison</h3>
          <div class="chart-container">
            <canvas id="satelliteComparisonChart"></canvas>
          </div>
        </div>
        
        <!-- SNR Chart -->
        <div class="chart-card">
          <h3><i class="fas fa-signal"></i> Signal Strength (SNR)</h3>
          <div class="chart-container">
            <canvas id="satelliteSNRChart"></canvas>
          </div>
        </div>
        
        <!-- C/N₀ Trend Chart -->
        <div class="chart-card">
          <h3><i class="fas fa-wave-square"></i> C/N₀ Trend</h3>
          <div class="chart-container">
            <canvas id="cn0TrendChart"></canvas>
          </div>
        </div>
        
        <!-- Anomaly Detection Chart -->
        <div class="chart-card">
          <h3><i class="fas fa-exclamation-triangle"></i> Anomaly Detection</h3>
          <div class="chart-container">
            <canvas id="snrAnomalyChart"></canvas>
          </div>
        </div>
      </div>
      
    </div>
  </section>
  
<!-- SDR Receiver Panel -->
<section class="card sdr-panel">
  <div class="card-header">
    <h2><i class="fas fa-broadcast-tower"></i> SDR Receiver</h2>
    <div class="controls">
      <button class="btn btn-primary" id="sdrStartBtn">
        <i class="fas fa-play"></i> Start
      </button>
      <button class="btn btn-danger" id="sdrStopBtn" disabled>
        <i class="fas fa-stop"></i> Stop
      </button>
      <button class="btn btn-secondary" id="sdrRecordBtn" disabled>
        <i class="fas fa-record-vinyl"></i> Record
      </button>
    </div>
  </div>

  <div class="card-content">
    <!-- SDR Device Status -->
        <div class="sdr-status">
        <div class="status-indicator" id="sdr-connection-indicator"></div>
        <span id="sdr-status-text">Disconnected</span>
        <span class="text-mono" id="sdr-device-info"></span>
        </div>

    <!-- Spectrum and Waterfall Display -->
    <div class="sdr-display-container">
      <canvas id="spectrumCanvas" height="150"></canvas>
      <canvas id="waterfallCanvas" height="300"></canvas>
    </div>

    <!-- Receiver Controls -->
    <div class="sdr-controls-grid">
      <!-- Frequency Control -->
      <div class="control-group">
        <label>Frequency (MHz)</label>
        <div class="control-wrapper">
          <input type="number" id="sdrFrequency" min="24" max="1766" step="0.001" value="105.000">
          <button class="btn btn-icon" id="sdrFreqUp">
            <i class="fas fa-chevron-up"></i>
          </button>
          <button class="btn btn-icon" id="sdrFreqDown">
            <i class="fas fa-chevron-down"></i>
          </button>
        </div>
      </div>

      <!-- Mode Selection -->
      <div class="control-group">
        <label>Mode</label>
        <select id="sdrMode" class="form-select">
          <option value="fm">FM</option>
          <option value="wfm">WFM</option>
          <option value="am">AM</option>
          <option value="usb">USB</option>
          <option value="lsb">LSB</option>
          <option value="cw">CW</option>
          <option value="raw">RAW</option>
        </select>
      </div>

      <!-- Gain Controls -->
      <div class="control-group">
        <label>LNA Gain</label>
        <div class="control-wrapper">
          <input type="range" id="sdrLnaGain" min="0" max="40" step="4.8" value="14.4">
          <span class="text-mono" id="sdrLnaValue">14.4 dB</span>
        </div>
      </div>

      <div class="control-group">
        <label>AGC</label>
        <div class="control-wrapper">
          <label class="switch">
            <input type="checkbox" id="sdrAgc" checked>
            <span class="slider"></span>
          </label>
          <span id="sdrAgcText">Enabled</span>
        </div>
      </div>
    </div>

    <!-- Audio Controls -->
    <div class="audio-output-controls">
      <div class="control-group">
        <label>Volume</label>
        <div class="control-wrapper">
          <input type="range" id="sdrVolume" min="0" max="100" step="1" value="50">
          <span class="text-mono" id="sdrVolumeValue">50%</span>
        </div>
      </div>
      <audio id="sdrAudioOutput" controls></audio>
    </div>

    <!-- Frequency Memory -->
    <div class="frequency-memory">
      <h3><i class="fas fa-memory"></i> Memory Channels</h3>
      <div class="memory-bank" id="sdrMemoryBank">
        <button class="btn btn-sm btn-secondary memory-btn" data-freq="88.5">88.5 FM</button>
        <button class="btn btn-sm btn-secondary memory-btn" data-freq="433.000">433.0</button>
        <button class="btn btn-sm btn-secondary" id="sdrAddMemory">
          <i class="fas fa-plus"></i> Add
        </button>
      </div>
    </div>
  </div>
</section>
<script>
    window.API_BASE_URL = "{{ api_base_url }}";
</script>
<script type="module" src="/static/js/main.js"></script>

</body>
</html>